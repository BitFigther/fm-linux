
# fm-linux

## 概要
- ファイル改変を検出するC言語製コマンドラインツールです。
- ソフトウェア導入やパッチ適用後の差分確認を想定して作成しました。

## 特徴
- **高速・軽量**: C言語実装で大規模ディレクトリも高速スキャンのはず。。
- **厳密な差分検出**: MD5ハッシュで内容変化を正確に検出
- **柔軟な対象指定**: 任意ディレクトリ・複数ディレクトリ対応
- **除外パターン**: サブディレクトリやファイル名の部分一致で除外可能
- **色付き出力**: 変更箇所を色分け表示（`--no-color`で無効化可）

## 必要なライブラリ
- OpenSSL (`libssl-dev`または`openssl-devel`)
  - OpenSSL 1.1.x / 3.0.x対応

### Ubuntu/Debian
```bash
sudo apt-get install libssl-dev
```

### CentOS/RHEL
```bash
sudo dnf install openssl-devel
```

## コンパイル
```bash
make
```
または手動で:
```bash
gcc -Wall -O2 -D_GNU_SOURCE -o fm fm.c -lssl -lcrypto
sudo cp -f ./bulid/fm /usr/local/bin/
```

## 引数

### 必須オプション
- 以下のうち1つは指定してください
- `--baseline` , `-B` <ディレクトリ(,ディレクトリ...)>
  - ベースライン作成モード。指定したディレクトリ配下のファイル情報を記録します。
  - デフォルトで`/tmp/fm_baseline.dat` で保存。
  - `--baseline-file`で任意のパスを指定可。

- `--check` , `-C` <ディレクトリ(,ディレクトリ...)>
  - 変更チェックモード。ベースラインと比較して変更・新規・削除ファイルを検出します。
  - `--baseline-file`で任意のベースラインファイルを指定可。

- `--reset` または `-R`  
  - ベースラインファイルを削除（リセット）します。
  - `--baseline-file`で任意のベースラインファイルを指定可。
  - デフォルトは`/tmp/fm_baseline.dat` を削除します。


### 任意オプション
- `--exclude <パターン>` または `-e <パターン>`  
  - 除外パターン（部分一致）。カンマ区切りや複数回指定可。
- `--baseline-file` , `-b` <ファイル名>
  - ベースラインファイル名を指定。
- `--no-color`  
  - 色付き出力を無効化。



## 使用例
### 1. ベースライン作成(作業前のベースになるファイル情報)
```bash
fm -B /etc,/usr
```

### 2. 変更チェック
```bash
fm -C /etc,/usr
```

### 3. ベースラインリセット
```bash
fm -R
```

### 除外パターン
`--exclude`で部分一致除外。カンマ区切りや複数回指定可。
```bash
fm -B / --exclude /tmp/,/var/log/
fm -C /usr,/etc --exclude /log/,/tmp/
```
- 以下のディレクトリは自動除外
  - `/tmp/`
  - `/var/log/`
  - `/proc/`
  -  `/sys/`
  - `/dev/`

### 色付き出力
デフォルトで色分け表示。`--no-color`で無効化。

## 終了コード
- `0`: 変更なし
- `1`: エラー
- `2`: 変更あり

## 注意事項・制限
- ベースラインファイル指定は最大8個。超過分は無視され警告。
- 除外パターンは部分一致。複数指定・複数回指定可。
- `--baseline-file`（`-b`）、`--exclude`（`-e`）を複数使用した場合**最後に指定した値のみ有効（上書き）**
- MD5計算は厳密だが処理時間増加。ファイル数が多い場合は時間がかかる場合あり。
- 読み取り不可ファイルは自動スキップ。
- OpenSSL 3.0対応（EVP API使用）。
- 色付き出力は`--no-color`で無効化可。

## ライセンス
このプロジェクトはMITライセンスの条項の下で配布されています。ライセンスの詳細については、[LICENSE](LICENSE)ファイルをご覧ください。